# -= Synapse =-
 Инструментарий создания и исполнения микросервисов для ИТ-службы предприятия

## Каталоги и их предназначение
```
/synapse/
  |-/.other/        - прочие файлы дистрибутива
  |-/client/        - место для готового клиентского приложения
  |-/client_source/ - исходный код клиентского приложения
  |-/core/          - файлы ядра Synapse
  |-/db/            
    |-synapse.db    - основная база данных Synapse
  |-/node_modules/  - стандартный системный каталог модулей nodejs
  |-/sslcert/       - сертификаты для https соединения
  |-/tasks/         - "задачи" - отдельные модули для отдельных задач
  |-/users/         - папки с результатами работы для пользователей
  |
  |-/package.json    - стандартный файл-описание пакета npm
  |-/synapse.js      - основное приложение (сервер); подробности настройки
                      запуска см. в app.js в комментариях
 ```

## Установка
### Необходимые компоненты (prerequisites)
- nodejs (https://nodejs.org/)
- git (https://git-scm.com/download/)
- Oracle Instant Сlient (https://github.com/oracle/node-oracledb)

```
C правами администратора:
\> npm install --global --production windows-build-tools
```
В каталоге, где предполагается разместить проект и выполните:
```
\> git clone https://github.com/yenesey/Synapse
\> cd Synapse
\> npm install
        
```

### TODO: расписать как создать чистую базу с нуля...
- cоздайте чистую базу /db/synapse.db, выполнив скрипт "./other/db.sql"


## Запуск приложения
    
###  Через node  
```
\> node synapse [--development] [--dev-server] [--port=N] [--base-url] [--ssl] [--service]

```
   --development  - запуск в режиме разработки, аналог переменной окружения NODE_ENV=development,
   --dev-server   - только фронт (сборка клиента webpack + hot)
   --base-url     - дает знать клиенту, куда бросать AJAX запросы (по умолчанию совпадает с <server>)
   --port=N       - задать прослушиваемый порт, аналог переменной окружения PORT
   --ssl          - запуск в режиме https, нужны сертификаты в конфигурации (не рекомендуется для --development)
   --service      - запустить как службу (влияет на обработку сигналов прерывания и закрытия процесса)
   
###  Через npm
```
\> npm run dev-front
\> npm run dev-back
\> npm run build

```
   "dev-front" - сборка клиентского приложения из исходных файлов в каталоге /client_source/ "на лету". Для сборки используется популярный сборщик (bundler) - Webpack. Основой клиентского приложения является компонентный фреймворк Vue.js. Если во время работы, в данном режиме изменить файл (компонент) клиентской части, то изменения будут отгружены в клиентский браузер и отображены в ту же секунду.
   
   "dev-back" - реализует бекэнд и его api/endpoints

   "build" - сборка статического клиента для пром. эксплуктации.
   
###  Рекомендации
 - сервер выводит информацию в stdout, который можно перенаправить в  файл (на усмотрение администратора)
 - для запуска в Windows в качестве сервиса рекомендуется использовать nssm. Запустите nssm.exe и следуйте указаниям, которые дает программа.

## Самостоятельная разработка задачи (специализированного модуля)
   
   Задача состоит из следующих компонентов:

- /tasks/<имя_модуля>.js   
- /client_source/tasks/<имя_модуля>.vue
- /db/synapse.db/<$tree>/objects/tasks/<имя_модуля>

###  Чтобы самому написать задачу /tasks/ вам потребуется знание JavaScript.
 Желательно (но не обязательно) знать JavaScript в версии ES5.1 с функционалкой (forEach, map, reduce), и ES6 со всеми этими Promise, стрелочными фунцкиями. Для запросов к базам данных понадобится знание SQL и изучение готовых примеров. В подкаталоге /tasks/ расположены отдельные модули для каждой решаемой задачи. Модули запускаются в отдельном процессе node, получают параметры через командную строку и отдают информацию в основной процесс через <stdout>. Для примера см. /tasks/validate.js. Дополнительно, схема работы клиента и сервера подробно описана в /core/tasks.js
   
###  В подкаталоге /client_source/tasks/ расположены .vue файлы для
 реализации интерфейса пользователя. Для примера см. validate.vue. Для начала достаточно немного понимать как работает язык html. В продвинутом варианте, можно добавлять расширенный функционал Vue.
   
###  Имя модуля /tasks/ и интерфейса /client_source/tasks/ должно совпадать.
 Кроме того,  необходимо внести запись в системную базу данных /db/synapse.db/<$tree>/objects/tasks/<имя модуля>
 Это позволит администратору раздавать права на задачу, тем самым позволяя ей появиться в меню пользователей

<hr>

## Снимки экрана

### v3.0 (@latest)
<img src="/.other/memories/v2.9.png" alt="Synapse v2.9"/>

### v2.8
<img src="/.other/memories/synapse.png" alt="Synapse v2.8"/>

